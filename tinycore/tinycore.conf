TC=12
KERN=5.10.3
ARCH=64 # ARCH= for x86 32 bits
tcrepo32="http://repo.tinycorelinux.net/$TC.x/x86"
tcrepo64="http://repo.tinycorelinux.net/$TC.x/x86_64"
tcrepo=${ARCH:-$tcrepo32}
tcrepo=${tcrepo/64/$tcrepo64}
tcsize=${ARCH:-32}
distro="release/distribution_files"
tczall="tcz"
#
# Meta packages collection
#
# sshonly : dropbear and keys maps
# usbkey  : for a working USB/ISO disk
# network : networking tools/modules
# test    : put here tcz to test
# develop : developing USB/ISO disk
# devtools: add git, autotools, etc.
#
tczmeta="sshonly usbkey test network develop devtools"
tczmeta="sshonly usbkey test develop devtools"
tczmeta="sshonly usbkey test"
tczmeta="sshonly usbkey"

####################### DO NOT EDIT BEYOND THIS LINE #######################

function tczmetamask() {
	declare i deps="" skipmeta="$2"
	[ -d "$1" ] || return 1
	echo "skipmeta: $skipmeta" >&2
	for i in $tczmeta; do
		[ "$skipmeta" == "$i" ] && continue  
		deps="$deps $(cat $1/conf.d/$i.lst | tr \\n ' ')"
	done
	shift 2
	for i in $@; do
		if echo "$deps" | grep -qe " $i"; then
			echo "skiptcz: $i" >&2
			continue
		fi
		echo -n " $i"
	done
}

function gettczlist() {
	declare i j tczlist="" deps="" adding
	[ -d "$1" ] || return 1
	for i in $tczmeta; do
		if [ ! -e $1/conf.d/$i.lst ]; then
			echo -e "\n\e[1;31mERROR: tinycore.conf, tczmeta='$i' unsupported\e[0m\n" >&2
			echo "ERROR"
			return 1
		fi
		if [ -e $1/tcz/$i-meta.tcz ]; then
			tczlist="$tczlist $i-meta.tcz"
			continue
		fi
		adding=$(cat $1/conf.d/$i.lst)
		tczlist="$tczlist $(tczmetamask $1 $i $adding)"
	done
	for i in $tczlist; do echo $i; done | sort | uniq
}

